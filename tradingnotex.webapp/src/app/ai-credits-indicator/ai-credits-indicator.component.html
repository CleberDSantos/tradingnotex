<!-- ai-credits-indicator.component.html -->
<!-- Este componente deve ser adicionado ao layout principal ou navega√ß√£o -->

<div *ngIf="showCreditsIndicator" class="credits-indicator animate-slide-up">
  <!-- Indicador Principal -->
  <div class="flex items-center gap-3">
    <div class="flex flex-col">
      <span class="text-xs text-gray-400">Cr√©ditos IA</span>
      <div class="flex items-center gap-2">
        <span class="credits-count">{{ currentCredits }}</span>
        <span class="text-xs text-gray-500">/{{ monthlyCredits }}</span>
      </div>
    </div>

    <!-- Status Visual -->
    <div class="relative">
      <svg class="w-10 h-10 transform -rotate-90">
        <circle
          cx="20"
          cy="20"
          r="16"
          stroke="#1b2330"
          stroke-width="4"
          fill="none"
        />
        <circle
          cx="20"
          cy="20"
          r="16"
          [attr.stroke]="getCreditsColor()"
          stroke-width="4"
          fill="none"
          [attr.stroke-dasharray]="100"
          [attr.stroke-dashoffset]="100 - (currentCredits / monthlyCredits * 100)"
          class="transition-all duration-500"
        />
      </svg>
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="text-lg">{{ getCreditsIcon() }}</span>
      </div>
    </div>
  </div>

  <!-- A√ß√µes R√°pidas -->
  <div class="flex gap-2 mt-3 pt-3 border-t border-edge">
    <button
      (click)="buyMoreCredits()"
      class="flex-1 px-3 py-1 bg-cyanx/20 hover:bg-cyanx/30 border border-cyanx/50 rounded text-xs font-medium transition-all">
      + Comprar
    </button>
    <button
      (click)="viewUsageHistory()"
      class="flex-1 px-3 py-1 bg-edge hover:bg-card rounded text-xs font-medium transition-all">
      üìä Hist√≥rico
    </button>
  </div>

  <!-- Aviso de Cr√©ditos Baixos -->
  <div *ngIf="currentCredits <= 2 && currentCredits > 0"
       class="mt-3 p-2 bg-accent/10 border border-accent/30 rounded text-xs text-accent">
    ‚ö†Ô∏è Cr√©ditos baixos! Considere comprar mais.
  </div>

  <!-- Sem Cr√©ditos -->
  <div *ngIf="currentCredits === 0"
       class="mt-3 p-2 bg-bad/10 border border-bad/30 rounded text-xs text-bad">
    ‚ùå Sem cr√©ditos! Compre para continuar usando IA.
  </div>
</div>

<!-- Modal de Uso de IA -->
<div *ngIf="showAIModal"
     class="fixed inset-0 bg-black/70 flex items-center justify-center z-50"
     (click)="closeAIModal()">
  <div class="bg-card border border-edge rounded-xl p-6 w-full max-w-md animate-slide-up"
       (click)="$event.stopPropagation()">

    <h2 class="text-xl font-semibold mb-4">ü§ñ Usar An√°lise com IA</h2>

    <!-- Op√ß√µes de An√°lise -->
    <div class="space-y-3">
      <button
        (click)="useAI('tradeAnalysis')"
        [disabled]="!canUseFeature('tradeAnalysis')"
        class="w-full p-4 bg-edge hover:bg-card border border-edge rounded-lg transition-all text-left group"
        [class.opacity-50]="!canUseFeature('tradeAnalysis')"
        [class.cursor-not-allowed]="!canUseFeature('tradeAnalysis')">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="font-semibold">An√°lise de Trade</h3>
            <p class="text-xs text-gray-400 mt-1">An√°lise detalhada do trade atual</p>
          </div>
          <div class="text-right">
            <span class="text-lg font-bold text-cyanx">1</span>
            <span class="text-xs text-gray-400 block">cr√©dito</span>
          </div>
        </div>
      </button>

      <button
        (click)="useAI('marketSuggestion')"
        [disabled]="!canUseFeature('marketSuggestion')"
        class="w-full p-4 bg-edge hover:bg-card border border-edge rounded-lg transition-all text-left group"
        [class.opacity-50]="!canUseFeature('marketSuggestion')"
        [class.cursor-not-allowed]="!canUseFeature('marketSuggestion')">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="font-semibold">Sugest√µes de Mercado</h3>
            <p class="text-xs text-gray-400 mt-1">Oportunidades baseadas em seu hist√≥rico</p>
          </div>
          <div class="text-right">
            <span class="text-lg font-bold text-accent">2</span>
            <span class="text-xs text-gray-400 block">cr√©ditos</span>
          </div>
        </div>
      </button>

      <button
        (click)="useAI('advancedAnalysis')"
        [disabled]="!canUseFeature('advancedAnalysis')"
        class="w-full p-4 bg-edge hover:bg-card border border-edge rounded-lg transition-all text-left group"
        [class.opacity-50]="!canUseFeature('advancedAnalysis')"
        [class.cursor-not-allowed]="!canUseFeature('advancedAnalysis')">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="font-semibold">An√°lise Avan√ßada</h3>
            <p class="text-xs text-gray-400 mt-1">An√°lise preditiva com backtesting</p>
          </div>
          <div class="text-right">
            <span class="text-lg font-bold text-pink">3</span>
            <span class="text-xs text-gray-400 block">cr√©ditos</span>
          </div>
        </div>
      </button>

      <button
        (click)="useAI('fullReport')"
        [disabled]="!canUseFeature('fullReport')"
        class="w-full p-4 bg-gradient-to-r from-purple/10 to-pink/10 border border-purple/30 rounded-lg transition-all text-left group"
        [class.opacity-50]="!canUseFeature('fullReport')"
        [class.cursor-not-allowed]="!canUseFeature('fullReport')">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="font-semibold text-purple">Relat√≥rio Completo</h3>
            <p class="text-xs text-gray-400 mt-1">Relat√≥rio profissional export√°vel</p>
          </div>
          <div class="text-right">
            <span class="text-lg font-bold text-purple">5</span>
            <span class="text-xs text-gray-400 block">cr√©ditos</span>
          </div>
        </div>
      </button>
    </div>

    <!-- Status de Cr√©ditos -->
    <div class="mt-4 p-3 bg-blacker rounded-lg">
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-400">Seus cr√©ditos:</span>
        <span class="text-xl font-bold" [ngClass]="getCreditsColorClass()">
          {{ currentCredits }}
        </span>
      </div>
      <div *ngIf="currentCredits < 5" class="mt-2">
        <button
          (click)="buyMoreCredits()"
          class="w-full px-3 py-2 bg-cyanx/20 hover:bg-cyanx/30 border border-cyanx/50 rounded text-sm font-medium transition-all">
          üí≥ Comprar Mais Cr√©ditos
        </button>
      </div>
    </div>

    <!-- Fechar -->
    <button
      (click)="closeAIModal()"
      class="mt-4 w-full px-4 py-2 bg-edge hover:bg-card rounded-lg font-medium transition-all">
      Cancelar
    </button>
  </div>
</div>

<!-- Toast de Feedback -->
<div *ngIf="showToast"
     class="fixed bottom-20 right-4 bg-card border border-edge rounded-lg p-4 shadow-xl animate-slide-up z-50">
  <div class="flex items-center gap-3">
    <span class="text-2xl">{{ toastIcon }}</span>
    <div>
      <p class="font-semibold">{{ toastTitle }}</p>
      <p class="text-xs text-gray-400">{{ toastMessage }}</p>
    </div>
  </div>
</div>
